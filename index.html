<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–°–µ–º–µ–π–Ω—ã–π –≤–∏—à-–ª–∏—Å—Ç</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

  <style>
    .container-narrow { max-width: 1024px; margin: 0 auto; padding: 0 16px; }
    .card { background:#fff; border:1px solid #e2e8f0; border-radius:16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .btn { display:inline-flex; align-items:center; justify-content:center; border-radius:12px; padding:10px 14px; font-size:14px; font-weight:600; }
    .btn-primary { background:#0f172a; color:#fff; }
    .btn-ghost { background:transparent; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .input, .textarea, .select { width:100%; border:1px solid #cbd5e1; border-radius:12px; padding:10px 12px; outline:none; }
    .input:focus, .textarea:focus, .select:focus { box-shadow: 0 0 0 4px #e2e8f0; }
    .badge { display:inline-flex; align-items:center; gap:6px; border-radius:999px; background:#f1f5f9; color:#334155; font-size:12px; padding:6px 10px; }
    .err { color:#b91c1c; font-size:12px; }
    .note { color:#64748b; font-size:12px; }
  </style>
</head>
<body class="bg-gradient-to-b from-white to-slate-50 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useState, useMemo } = React;

    // === Firebase init ===
    const firebaseConfig = {
      apiKey: "AIzaSyC26Xjjr0pFQDVFtCgRyteEpNEjngVOJFI",
      authDomain: "wishlist-37819.firebaseapp.com",
      projectId: "wishlist-37819",
      storageBucket: "wishlist-37819.firebasestorage.app",
      messagingSenderId: "72495355387",
      appId: "1:72495355387:web:0ff709125d3cf33c8c275e"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    auth.signInAnonymously().catch(console.error);

    // Col helpers
    const listsCol = () => db.collection('lists');
    const listDoc  = (listId) => listsCol().doc(listId);
    const itemsCol = (listId) => listDoc(listId).collection('items');
    const claimsCol= (listId) => listDoc(listId).collection('claims');

    // utils
    const saveLocal = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const loadLocal = (k, fb) => { try { return JSON.parse(localStorage.getItem(k)) ?? fb } catch { return fb } }
    const prettyPrice = (p) => {
      if (!p) return '';
      const num = Number(String(p).replace(/[^0-9.,]/g, '').replace(',', '.'));
      if (Number.isFinite(num)) return new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' }).format(num);
      return p;
    };

    // ===== WIZARD SCREENS =====
    function StatusBar({ listId, authUid, ownerUid, mode }) {
      return (
        <div className="container-narrow">
          <div className="text-xs text-slate-500 py-2">
            <span className="mr-4">üóÇ listId: <b>{listId || '‚Äî'}</b></span>
            <span className="mr-4">üë§ uid: <code>{authUid || '‚Äî'}</code></span>
            <span className="mr-4">‚≠ê ownerUid: <code>{ownerUid || '‚Äî'}</code></span>
            <span>‚öôÔ∏è mode: <b>{mode || 'single_owner'}</b></span>
          </div>
        </div>
      );
    }

    // Screen 1 ‚Äî choose/create list
    function ScreenChooseList({ lists, listId, setListId, onCreateNew, onNext }) {
      const [newName, setNewName] = useState('');
      return (
        <div className="container-narrow">
          <div className="card p-6 space-y-4">
            <h2 className="text-xl font-semibold">–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–∑–¥–Ω–∏–∫</h2>

            <div className="space-y-2">
              <div className="text-sm text-slate-600">–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:</div>
              <div className="grid gap-2">
                {lists.length === 0 && <div className="note">–ü–æ–∫–∞ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∏–∂–µ.</div>}
                {lists.map(l => (
                  <button key={l.id}
                    className={`btn ${listId===l.id?'btn-primary':'btn-ghost border'}`}
                    onClick={()=>setListId(l.id)}>
                    {l.id} {l.mode ? `¬∑ ${l.mode}` : ''}
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-2">
              <div className="text-sm text-slate-600">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫/–ª–∏—Å—Ç</div>
              <div className="grid gap-2 md:grid-cols-[1fr_auto]">
                <input className="input" value={newName} onChange={e=>setNewName(e.target.value)} placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –í–∞–ª–µ—Ä—ã, newyear2025" />
                <button className="btn btn-ghost border" onClick={()=>{ if(newName.trim()){ onCreateNew(newName.trim()); setNewName(''); }}}>–°–æ–∑–¥–∞—Ç—å</button>
              </div>
              <div className="note">ID —Å–ø–∏—Å–∫–∞ ‚Äî —Ç–æ, —á—Ç–æ –±—É–¥–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–º—å–µ –∫–∞–∫ ¬´–∞–¥—Ä–µ—Å¬ª —Å–ø–∏—Å–∫–∞.</div>
            </div>

            <div className="pt-2">
              <button className="btn btn-primary" disabled={!listId} onClick={onNext}>–î–∞–ª–µ–µ</button>
            </div>
          </div>
        </div>
      );
    }

    // Screen 2 ‚Äî identity + role
    function ScreenIdentity({ displayName, setDisplayName, role, setRole, mode, setMode, canEditMeta, onContinue }) {
      return (
        <div className="container-narrow">
          <div className="card p-6 space-y-4">
            <h2 className="text-xl font-semibold">–ö—Ç–æ –≤—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞?</h2>
            <div className="grid gap-3 md:grid-cols-2">
              <input className="input" value={displayName} onChange={e=>setDisplayName(e.target.value)} placeholder="–í–∞—à–µ –∏–º—è" />
              <select className="select" value={role} onChange={e=>setRole(e.target.value)}>
                <option value="owner">–ü–æ–ª—É—á–∞—Ç–µ–ª—å (–∞–≤—Ç–æ—Ä —Å–ø–∏—Å–∫–∞)</option>
                <option value="santa">–î–∞—Ä–∏—Ç–µ–ª—å</option>
              </select>
              <div className="md:col-span-2 grid gap-2 md:grid-cols-2">
                <select className="select" value={mode} onChange={e=>setMode(e.target.value)} disabled={!canEditMeta}>
                  <option value="single_owner">–†–µ–∂–∏–º: –≤–ª–∞–¥–µ–ª–µ—Ü –¥–æ–±–∞–≤–ª—è–µ—Ç (–¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è)</option>
                  <option value="open">–†–µ–∂–∏–º: –¥–æ–±–∞–≤–ª—è—é—Ç –≤—Å–µ (–ù–æ–≤—ã–π –≥–æ–¥)</option>
                </select>
                <div className="note flex items-center">{!canEditMeta ? '–ú–µ–Ω—è—Ç—å —Ä–µ–∂–∏–º –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü' : '–í—ã –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å —Ä–µ–∂–∏–º —Å–ø–∏—Å–∫–∞'}</div>
              </div>
            </div>
            <div className="pt-2">
              <button className="btn btn-primary" onClick={onContinue}>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
          </div>
        </div>
      );
    }

    // Screen 3 ‚Äî list UI
    function AddItemForm({ onAdd, disabled, error }) {
      const [title, setTitle] = useState('');
      const [url, setUrl] = useState('');
      const [price, setPrice] = useState('');
      const [note, setNote] = useState('');
      const submit = () => {
        if (disabled) return;
        if (!title.trim()) return;
        onAdd({ title: title.trim(), url: url.trim(), price: price.trim(), note: note.trim() });
        setTitle(''); setUrl(''); setPrice(''); setNote('');
      };
      return (
        <div className="card p-4">
          <div className="grid gap-3 md:grid-cols-3">
            <div className="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3">
              <input className="input" value={title} onChange={e=>setTitle(e.target.value)} placeholder="–ß—Ç–æ —Ö–æ—á—É" />
              <input className="input" value={price} onChange={e=>setPrice(e.target.value)} placeholder="–¶–µ–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
              <div className="md:col-span-2 flex items-center gap-2">
                <span className="text-slate-500">üîó</span>
                <input className="input" value={url} onChange={e=>setUrl(e.target.value)} placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä" />
              </div>
              <div className="md:col-span-2">
                <textarea className="textarea" rows="3" value={note} onChange={e=>setNote(e.target.value)} placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
              </div>
            </div>
            <div className="flex flex-col gap-2">
              <button className="btn btn-primary w-full" onClick={submit} disabled={disabled}>‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
              {disabled && <div className="note">–û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤–ª–∞–¥–µ–ª—å—Ü–∞‚Ä¶</div>}
              {error && <div className="err">{error}</div>}
            </div>
          </div>
        </div>
      );
    }

    function ItemCard({ item, role, authUid, claimData, onClaim, onUnclaim }) {
      const claimed = !!claimData;
      const myItem = item.addedByUid && authUid && item.addedByUid === authUid;

      return (
        <div className="card p-3">
          <div className="flex items-start justify-between gap-3">
            <div>
              <div className="text-base font-semibold">{item.title}</div>
              {item.price && <div className="text-sm text-slate-500">{prettyPrice(item.price)}</div>}
              {item.note && <div className="text-sm text-slate-500 mt-1">{item.note}</div>}
              {item.url && <div className="mt-1"><a className="text-sm underline" target="_blank" rel="noreferrer" href={item.url}>–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</a></div>}
            </div>
            {role === 'santa' && (
              <div className="min-w-[160px] text-right">
                {myItem ? (
                  <span className="badge">–≠—Ç–æ –≤–∞—à –ø–æ–¥–∞—Ä–æ–∫</span>
                ) : !claimed ? (
                  <button className="btn btn-ghost border" onClick={()=>onClaim(item.id)}>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                ) : (
                  <span className="badge">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: {claimData.claimerName}</span>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    function ScreenList({
      listId, role, mode, canEditMeta, setMode,
      authUid, ownerUid, items, claims, addItem, writeError, onClaim
    }) {
      const canAdd = role === 'owner' || mode === 'open';
      return (
        <div className="container-narrow space-y-4">
          <div className="card p-4 flex flex-wrap gap-3 items-center justify-between">
            <div className="font-medium">–°–ø–∏—Å–æ–∫: {listId}</div>
            <div className="flex items-center gap-2">
              <select className="select" value={mode} onChange={e=>setMode(e.target.value)} disabled={!canEditMeta}>
                <option value="single_owner">–†–µ–∂–∏–º: –≤–ª–∞–¥–µ–ª–µ—Ü –¥–æ–±–∞–≤–ª—è–µ—Ç</option>
                <option value="open">–†–µ–∂–∏–º: –¥–æ–±–∞–≤–ª—è—é—Ç –≤—Å–µ</option>
              </select>
              {!canEditMeta && <span className="note">–†–µ–∂–∏–º –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü</span>}
            </div>
          </div>

          {canAdd && role === 'owner' && <AddItemForm onAdd={addItem} disabled={false} error={writeError} />}
          {canAdd && role !== 'owner' && mode === 'open' && <div className="note">–í ¬´open¬ª —Ä–µ–∂–∏–º–µ –¥–æ–±–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç –ª—é–±–æ–π —É—á–∞—Å—Ç–Ω–∏–∫.</div>}
          {!canAdd && <div className="note">–î–æ–±–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å (–≤–ª–∞–¥–µ–ª–µ—Ü) —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞.</div>}

          <div className="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
            {items.map(it => (
              <ItemCard key={it.id} item={it} role={role} authUid={authUid} claimData={claims[it.id]} onClaim={onClaim} />
            ))}
          </div>

          {items.length === 0 && (
            <div className="text-center text-slate-500 py-12">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ –∂–µ–ª–∞–Ω–∏–µ!</div>
          )}
        </div>
      );
    }

    // ===== APP =====
    function App() {
      const [screen, setScreen] = useState(1); // 1 choose list, 2 identity, 3 list
      const [lists, setLists] = useState([]);
      const [listId, setListId] = useState(loadLocal('wish:listId', ''));
      const [displayName, setDisplayName] = useState(loadLocal('wish:name', ''));
      const [role, setRole] = useState('santa'); // santa | owner
      const [mode, setMode] = useState('single_owner'); // single_owner | open

      const [authUid, setAuthUid] = useState(null);
      const [ownerUid, setOwnerUid] = useState(null);
      const [items, setItems] = useState([]);
      const [claims, setClaims] = useState({});
      const [writeError, setWriteError] = useState('');

      // auth
      useEffect(()=> {
        const unsub = auth.onAuthStateChanged(u => setAuthUid(u?.uid || null));
        return () => unsub();
      }, []);

      // lists feed
      useEffect(()=> {
        const unsub = listsCol().orderBy('updatedAt','desc').limit(50)
          .onSnapshot(s => setLists(s.docs.map(d => ({ id: d.id, ...d.data() }))));
        return () => unsub && unsub();
      }, []);

      // save locals
      useEffect(()=>saveLocal('wish:listId', listId), [listId]);
      useEffect(()=>saveLocal('wish:name', displayName), [displayName]);

      // meta of current list
      useEffect(()=> {
        if (!listId) return;
        const unsub = listDoc(listId).onSnapshot(s => {
          const d = s.data() || {};
          setOwnerUid(d.ownerUid || null);
          setMode(d.mode || 'single_owner');
        });
        return () => unsub && unsub();
      }, [listId]);

      // items / claims
      useEffect(()=> {
        if (!listId) return;
        const unsub = itemsCol(listId).orderBy('createdAt','desc')
          .onSnapshot(s => setItems(s.docs.map(d => ({ id: d.id, ...d.data() }))));
        return () => unsub && unsub();
      }, [listId]);

      useEffect(()=> {
        if (!listId || role !== 'santa') { setClaims({}); return; }
        const unsub = claimsCol(listId).onSnapshot(s => {
          const obj = {};
          s.forEach(d => obj[d.id] = d.data());
          setClaims(obj);
        });
        return () => unsub && unsub();
      }, [listId, role]);

      // create new list
      const onCreateNew = async (name) => {
        await listDoc(name).set({ updatedAt: Date.now(), mode: 'single_owner' }, { merge: true });
        setListId(name);
      };

      // proceed from screen 1 to 2
      const go2 = () => setScreen(2);

      // continue to screen 3 ‚Äî set owner if recipient
      const onContinue = async () => {
        try {
          if (!listId) return;

          // –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ä–µ–∂–∏–º; –µ—Å–ª–∏ ¬´–ü–æ–ª—É—á–∞—Ç–µ–ª—å¬ª ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º ownerUid
          if (role === 'owner') {
            await listDoc(listId).set({
              ownerUid: authUid,
              mode,
              updatedAt: Date.now()
            }, { merge: true });
          } else {
            // –¥–∞—Ä–∏—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–º—è; —Ä–µ–∂–∏–º —Ç—Ä–æ–≥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
            await listDoc(listId).set({ updatedAt: Date.now() }, { merge: true });
          }
          setScreen(3);
        } catch (e) {
          console.error(e);
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–∏—Å–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firestore Rules.');
        }
      };

      // actions
      const addItem = async ({ title, url, price, note }) => {
        setWriteError('');
        try {
          // –≤ single_owner –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–ª–∞–¥–µ–ª–µ—Ü; –≤ open ‚Äî –ª—é–±–æ–π
          if (mode === 'single_owner' && authUid !== ownerUid) {
            setWriteError('–î–æ–±–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å (–≤–ª–∞–¥–µ–ª–µ—Ü) —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞.');
            return;
          }
          await itemsCol(listId).add({
            title, url, price, note,
            addedByUid: authUid,
            createdAt: Date.now()
          });
          await listDoc(listId).set({ updatedAt: Date.now() }, { merge: true });
        } catch (e) {
          console.error(e);
          setWriteError('–ù–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore.');
        }
      };

      const onClaim = async (itemId) => {
        setWriteError('');
        try {
          const item = items.find(i => i.id === itemId);
          if (item?.addedByUid === authUid) {
            setWriteError('–ù–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫.');
            return;
          }
          const c = await claimsCol(listId).doc(itemId).get();
          if (c.exists) {
            setWriteError('–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ —É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω.');
            return;
          }
          await claimsCol(listId).doc(itemId).set({
            claimerUid: authUid,
            claimerName: displayName || '–ë–µ–∑ –∏–º–µ–Ω–∏',
            createdAt: Date.now()
          });
        } catch (e) {
          console.error(e);
          setWriteError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore.');
        }
      };

      const canEditMeta = role === 'owner' && authUid && ownerUid === authUid;

      return (
        <div className="pb-10">
          <div className="container-narrow py-6 flex items-center gap-3">
            <div className="w-9 h-9 rounded-xl bg-slate-900 text-white flex items-center justify-center">üéÅ</div>
            <div>
              <h1 className="text-2xl font-semibold">–°–µ–º–µ–π–Ω—ã–π –≤–∏—à-–ª–∏—Å—Ç</h1>
              <p className="text-sm text-slate-500">–®–∞–≥–∏: –≤—ã–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ ‚Üí —É–∫–∞–∑–∞—Ç—å —Ä–æ–ª—å ‚Üí —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–ø–∏—Å–∫–æ–º</p>
            </div>
          </div>

          <StatusBar listId={listId} authUid={authUid} ownerUid={ownerUid} mode={mode} />

          {screen === 1 && (
            <ScreenChooseList
              lists={lists}
              listId={listId}
              setListId={setListId}
              onCreateNew={onCreateNew}
              onNext={go2}
            />
          )}

          {screen === 2 && (
            <ScreenIdentity
              displayName={displayName}
              setDisplayName={setDisplayName}
              role={role}
              setRole={setRole}
              mode={mode}
              setMode={setMode}
              canEditMeta={true /* –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ –ø–æ–∑–≤–æ–ª—è–µ–º –≤—ã–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º, –Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –æ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã "–ü–æ–ª—É—á–∞—Ç–µ–ª—å" */}
              onContinue={onContinue}
            />
          )}

          {screen === 3 && (
            <ScreenList
              listId={listId}
              role={role}
              mode={mode}
              canEditMeta={canEditMeta}
              setMode={async (m)=>{
                setMode(m);
                if (canEditMeta) {
                  await listDoc(listId).set({ mode: m, updatedAt: Date.now() }, { merge: true });
                }
              }}
              authUid={authUid}
              ownerUid={ownerUid}
              items={items}
              claims={claims}
              addItem={addItem}
              writeError={writeError}
              onClaim={onClaim}
            />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
